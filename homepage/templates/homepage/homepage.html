{% extends "shared/base.html" %}

{% block inheritor %}
<style>
  #sidebar {
    display:inline-block;
    width:20%;
    height:100%;
    background-color:#778;
    position:fixed;
    left:0px;
    top:0px;
    padding:50px 0px 0px 0px;
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
    /* citation [7] */
    overflow:hidden;
    /* end citation */
  }
  /* citation [7] */
  #followingContainer {
    width:100%;
    margin-right:-50px;
    padding-right:50px;
    max-height:100%;
    overflow-y:scroll;
    overflow-x:hidden;

  }
  /* end citation */
  #following {
    width:100%;
    height:10000px;
    margin:0px;
  }
  #following > * {
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
  }
  #feedViewport {
    display:inline-block;
    width:80%;
    height:100%;
    float:right;
    margin:0px;
    /* citation [7] */
    overflow:hidden;
    /* end citation */
  }
  #feedContainer {
    width:100%;
    /* citation [7] */
    overflow-y:scroll;
    overflow-x:hidden;
    margin-right:-50px;
    padding-right:50px;
    height:100%;
    /* end citation */
  }
  #feed {
    width:100%;
    margin-top:60px;
    margin-left:10px;
  }
  #updatesTitle {
    text-align:center;
    color:#778;
  }
  #followingTitle {
    text-align:center;
  }
  #noPostsAlert {
    text-align:center;
  }
  #encouragement {
    text-align:center;
  }
  #updatesDiv {
    width:75%;
    /* citation [5] */
    margin:auto;
    /* end citation */
  }
  .update {
    width:100%;
    background-color:#778;
    margin:20px 0px 20px 0px;
  }
  .update > *, .update > * > * {
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
  }
  .updateHeader, .updateFooter {
    background-color:#667;

  }
  .updateHeader > * {
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
    margin:10px;
  }
  .updatedTag {
    background-color:#f22;
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
    padding:3px;
    display:inline-block;
    margin-right:10px;
    font-size:11px;
  }
  .updateFooter {
    padding:0px;
  }
  .userPicture {
    width:40px;
    height:40px;
    border-radius:0px;
    background-color: #000;
    display:inline-block;
    margin-bottom:-4px;
  }
  .usernameOuter, .followedUserUsernameOuter {
    display:inline-block;
    margin-left:10px;
    margin-bottom:-4px;
    height:40px;
  }
  .usernameInner, .followedUserUsernameInner {
    height:100%;
    /* citation [10] (continues on to the usernameCell class CSS definition, see citation end tag) */
    display:table;
  }
  .usernameCell, .followedUserUsernameCell {
    display:table-cell;
    vertical-align: middle;
    /* end citation */
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
  }
  .usernameCell > a, .followedUserUsernameCell > a {
    text-decoration:none;
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
  }
  .updateHeaderComponent {
    display:inline-block;
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
    margin-right:10px;
  }
  .usernameDiv {
    height:100%;
    top:0;
    font-size:20px;
  }
  .workoutTitle {
    font-size:20px;
    display:inline-block;
  }
  .workoutStats {
    display:inline-block;
    float:right;
  }
  .workoutSummary {
    margin:20px;
  }
  .followedUser {
    margin:10px;
  }
  .followedUser > div {
    display:inline-block;
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
  }
  .followedUserPicture {
    width:40px;
    height:40px;
    border-radius:0px;
    background-color: #000;
    margin-bottom:-4px;
  }
  .workoutLink {
    text-decoration:none;
    color: #fdfdfd; /* HTML color picker used (citation [2] in top-level repository README) */
  }
</style>
<div id="sidebar">
  <div id="followingContainer">
    <div id="following">
      <h3 id="followingTitle">
        {{ followingTitle }}
      </h3>
      <div>
        {% for follow in follows %}
        <div class="followedUser">
          <div class="followedUserPicture">
          </div>
          <div class="followedUserUsernameOuter">
            <!-- citation [10] -->
            <div class="followedUserUsernameInner">
              <div class="followedUserUsernameCell">
                <a href="{% url "userView" follow.username %}">{{ follow.username }}</a>
              </div>
            </div>
            <!-- end citation -->
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<div id="feedViewport">
  <div id="feedContainer" onscroll="checkForScrollBottomHit();">
    <div id="feed">
      <h1 id="updatesTitle">
        {{ updatesTitle }}
      </h1>
      <div id="updatesDiv">
        {% include "homepage/updates.html" %}
      </div>
      <h3 id="noPostsAlert" {% if updates.count != 0 %}hidden{% endif %}>
        {{ noPosts }}
      </h3>
      <h4 id="encouragement" {% if updates.count != 0 %}hidden{% endif %}>
        {{ encouragement }}
      </h4>
    </div>
  </div>
</div>
<script>
  var earliestID = {% if updates|length > 0 %}{{ updates.last.id }}{% else %}-1{% endif %};
  // noMoreUpdates usage from citation [23]
  var noMoreUpdates = false;
  function checkForScrollBottomHit() {
    var feedContainer = $("#feedContainer");
    // condition in next "if" statement from citation [22]
    if (feedContainer.scrollTop() + feedContainer.height() >= $("#feed").outerHeight() && !noMoreUpdates) {
      if (earliestID >= 0) {
        $.ajax("{% url "homepage" %}", {
          method  : "POST",
          data    : {
            lastID              : earliestID,
            // next line from citation [15]
            csrfmiddlewaretoken : "{{ csrf_token }}",
            todo                : "fetchMoreUpdates"
          },
          dataType: "json",
          success : function(ajaxResponseText, ajaxStatus, ajaxResponse) {
            earliestID = ajaxResponseText['id']
            $("#updatesDiv").append(ajaxResponseText['html'])
          },
          error   : function(ajaxResponse, ajaxStatus, ajaxError) {
            // noMoreUpdates usage from citation [23]
            noMoreUpdates = true;
            $("#encouragement").show();
            $("#noPostsAlert").show();
          }
        });
      }
    }
  }
</script>
{% endblock %}
